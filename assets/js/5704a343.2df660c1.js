"use strict";(self.webpackChunksake=self.webpackChunksake||[]).push([[96],{365:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>t});var s=i(5893),l=i(1151);const r={},a="Development",o={id:"development",title:"Development",description:"Build instructions",source:"@site/../../sake/docs/development.md",sourceDirName:".",slug:"/development",permalink:"/development",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"sidebar",previous:{title:"Performance",permalink:"/performance"},next:{title:"Contributing",permalink:"/contributing"}},d={},t=[{value:"Build instructions",id:"build-instructions",level:2},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Building",id:"building",level:3},{value:"Developing",id:"developing",level:2},{value:"Releasing",id:"releasing",level:2},{value:"Overview of How Sake Works",id:"overview-of-how-sake-works",level:2},{value:"Dependency Graph",id:"dependency-graph",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"development",children:"Development"}),"\n",(0,s.jsx)(n.h2,{id:"build-instructions",children:"Build instructions"}),"\n",(0,s.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://golang.org/doc/install",children:"go 1.19 or above"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://goreleaser.com/install/",children:"goreleaser"})," (optional)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/golangci/golangci-lint",children:"golangci-lint"})," (optional)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"building",children:"Building"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Build sake for your platform target\nmake build\n\n# Build sake binaries and archives for all platforms using goreleaser\nmake build-all\n\n# Generate Manpage\nmake gen-man\n"})}),"\n",(0,s.jsx)(n.h2,{id:"developing",children:"Developing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# Format code\nmake gofmt\n\n# Manage dependencies (download/remove unused)\nmake tidy\n\n# Lint code\nmake lint\n\n# Standing in examples directory you can run the following to debug faster\ngo run ../main.go run ping -a\n"})}),"\n",(0,s.jsx)(n.h2,{id:"releasing",children:"Releasing"}),"\n",(0,s.jsxs)(n.p,{children:["The following workflow is used for releasing a new ",(0,s.jsx)(n.code,{children:"sake"})," version:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Create pull request with changes"}),"\n",(0,s.jsxs)(n.li,{children:["Verify build works (especially windows build)","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"make build"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"make build-all"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Pass all integration and unit tests locally","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"make integration-test"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"make unit-test"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Run benchmarks and profiler to check performance","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"make benchmark"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Update ",(0,s.jsx)(n.code,{children:"config-reference.md"})," and ",(0,s.jsx)(n.code,{children:"config.man"})," if any config changes and generate manpage","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"make gen-man"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Update ",(0,s.jsx)(n.code,{children:"Makefile"})," and ",(0,s.jsx)(n.code,{children:"CHANGELOG.md"})," with correct version, and add all changes to ",(0,s.jsx)(n.code,{children:"CHANGELOG.md"})]}),"\n",(0,s.jsxs)(n.li,{children:["Squash-merge to main with ",(0,s.jsx)(n.code,{children:"Release vx.y.z"})," and description of changes"]}),"\n",(0,s.jsxs)(n.li,{children:["Run ",(0,s.jsx)(n.code,{children:"make release"}),", which will:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Create a git tag with release notes"}),"\n",(0,s.jsx)(n.li,{children:"Trigger a build in Github that builds cross-platform binaries and generates release notes of changes between current and previous tag"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"overview-of-how-sake-works",children:"Overview of How Sake Works"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Parse & validate CLI arguments"}),"\n",(0,s.jsxs)(n.li,{children:["Parse ",(0,s.jsx)(n.code,{children:"sake"})," config files and create config, inventory, tasks, specs, and target states"]}),"\n",(0,s.jsx)(n.li,{children:"Create clients for remote and local task execution for the selected hosts/tasks"}),"\n",(0,s.jsx)(n.li,{children:"Execute tasks on remote/local hosts"}),"\n",(0,s.jsx)(n.li,{children:"Disconnect from remote hosts"}),"\n",(0,s.jsx)(n.li,{children:"Print any output (results, reports, errors, etc.)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"dependency-graph",children:"Dependency Graph"}),"\n",(0,s.jsxs)(n.p,{children:["Create SVG dependency graphs using graphviz and ",(0,s.jsx)(n.a,{href:"https://github.com/loov/goda",children:"goda"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'goda graph "github.com/alajmo/sake/..." | dot -Tsvg -o res/graph.svg\ngoda graph "github.com/alajmo/sake:all" | dot -Tsvg -o res/graph-full.svg\n'})})]})}function h(e={}){const{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>o,a:()=>a});var s=i(7294);const l={},r=s.createContext(l);function a(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);