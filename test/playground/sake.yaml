known_hosts_file: known_hosts
disable_verify_host: true

servers:
  localhost:
    desc: localhost
    host: localhost
    local: true
    work_dir: /opt
    tags: [local]

  many:
    desc: many hosts
    # hosts:
    #   - 172.24.2.2
    #   - 172.24.2.4
    hosts: $(cat list-of-servers.txt)
    # hosts: $(echo "172.24.2.2 $host")
    # hosts: 172.24.2.[4:6:1]
    # hosts: 172.24.2.2
    # hosts: 172.24.2.[2:4]
    # host: 172.24.2.2
    user: test
    identity_file: ../keys/id_ed25519_pem_no
    tags: [remote, pi, many]
    env:
      hello: world
      host: 172.24.2.4

  server-1:
    desc: server-1
    host: sake-resolve
    bastion: 172.24.2.99
    user: test
    identity_file: ../keys/id_ed25519_pem_no
    tags: [remote, pi]

  server-2:
    desc: server-2
    host: sake-resolve
    tags: [remote, pi]

  server-3:
    desc: server-3
    host: 172.24.2.4
    user: test
    identity_file: ../keys/id_ed25519_pem_no
    tags: [remote, pi, pihole]

  server-4:
    desc: server-4
    host: 172.24.2.5
    user: test
    identity_file: ../keys/id_ed25519_pem
    password: testing
    tags: [remote, pi, pihole]

  ip6-1:
    desc: ip6-1
    host: test@[2001:3984:3989::10]:22
    user: test
    password: test
    tags: [remote, reachable]

  ip6-2:
    desc: ip6-2
    host: 2001:3984:3989::11
    port: 33
    user: test
    password: test
    tags: [remote, reachable]

targets:
  all:
    all: true

  limit:
    all: true
    limit: 3

  limit-p:
    all: true
    limit-p: 50

specs:
  table:
    output: table

  text:
    output: text

  info:
    output: table
    parallel: true
    ignore_errors: true
    ignore_unreachable: true
    any_errors_fatal: false

env:
  VERSION: v0.1.0
  DATE: $(date -u +"%Y-%m-%dT%H:%M:%S%Z")

tasks:
  exit:
    # name: hej
    local: true
    cmd: exit 3

  ping:
    desc: ping server
    cmd: echo $SAKE_SERVER_NAME

  sleep:
    desc: ping server
    cmd: sleep 2 & echo done

  # Info
  print-host:
    name: Host
    desc: print host
    spec: info
    target: all
    cmd: echo $SAKE_SERVER_HOST

  print-hostname:
    name: Hostname
    desc: print hostname
    spec: info
    target: all
    cmd: hostname

  print-os:
    name: OS
    desc: print OS
    spec: info
    target: all
    cmd: |
      os=$(lsb_release -si)
      release=$(lsb_release -sr)
      echo "$os $release"

  print-kernel:
    name: Kernel
    desc: Print kernel version
    spec: info
    target: all
    cmd: uname -r | awk -v FS='-' '{print $1}'
